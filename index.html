<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Route Scanner</title>
        <link rel="stylesheet" href="pose/styles.css" />
    </head>
    
    <body>
        <div class="main-wrapper">
            <div class="column" style="width: 100%; align-items: flex-start;"> 
                <h1>Route Scanner</h1>    
                <div id="status" class="status">Load a video to get started.</div>
            </div>
            <div class="controls card">
                <!-- Video File Input -->
                <label>
                    <span>Select video: </span>
                    <input id="videoFile" type="file" accept="video/*" />
                </label>

                <!-- Detect Pose Landmarks in Extracted Frames -->            
                <button id="frameDetectBtn" disabled>Detect Pose Landmarks</button>
                <!-- Stop Detection -->
                <button id="stopBtn" disabled>Stop</button>
                <!-- Download JSON Data -->
                <button id="downloadBtn" disabled>Download JSON</button>
                <button id="showOrb" disabled>Detect ORB</button>
            </div>

            <div id="poseSection" class="row" style="align-items: flex-start;">
                <div class="column" style="width: 25%;">
                    <!-- Set Interval for Frame Extraction -->
                    <label>
                        Interval (seconds): <input id="intervalInput" type="number" min="1" value="1" />
                    </label>
                </div>
            
                <!-- Video and Overlay Canvas with Crop Box -->
                <div id="videoCropContainer" style="position:relative; display:inline-block; max-width:75%;">
                    <!-- Video Element-->
                    <video id="video" controls style="max-width:100%;"></video>
                    <!-- Canvas to Overlay Pose Landmarks-->
                    <canvas id="overlay" class="pose-canvas" style="position:absolute; left:0; top:0; pointer-events:none;"></canvas>
                    <!-- Crop Box for Selecting Region of Interest -->
                    <div id="cropBoxPose" class="crop-box" style="position:absolute;" hidden>
                        <!-- Resize Handles (Draggable Corners) -->
                        <div class="resize-handle" data-corner="nw"></div>
                        <div class="resize-handle" data-corner="ne"></div>
                        <div class="resize-handle" data-corner="sw"></div>
                        <div class="resize-handle" data-corner="se"></div>
                    </div>
                    <!-- Frame Navigation for Extracted Frames -->
                    <div id="frameNav" style="display:none; margin:24px 0px; gap: 10px; justify-self: center;">
                        <button id="prevFrameBtn">Previous</button>
                        <span id="frameCounter"></span>
                        <button id="nextFrameBtn">Next</button>
                    </div>
                </div>
            </div>

            <!-- ORB parameters and action buttons -->
            <div id="detectOrb" style="width: 100%;">
                <h2>Extract and Export ORB Features</h2>
                <div class="row" style="width:100%; align-items:flex-start; gap:24px; justify-content: space-between; margin-bottom: 48px;">
                <div class="column muted params">
                    <div class="row param">
                    nfeatures <input id="nfeatures" type="number" value="1200" min="100" max="5000">
                    </div>
                    <div class="row param">
                    nlevels <input id="nlevels" type="number" value="8" min="1" max="20">
                    </div>
                    <div class="row param">
                    scaleFactor <input id="scaleFactor" type="number" step="0.1" value="1.2">
                    </div>
                    <div class="row param">
                    edgeThres <input id="edgeThreshold" type="number" value="31" min="1" max="100">
                    </div>
                    <div class="row param">
                    fastThresh <input id="fastThreshold" type="number" value="20" min="1" max="100">
                    </div>
                    <div class="row param">
                    patchSize <input id="patchSize" type="number" value="31" min="1" max="100">
                    </div>
                    <button id="btnDetect" style="margin: 24px 0; width: 100%;" disabled>Detect ORB</button>
                    <button id="btnDownload" style="width: 100%;" disabled>Download features.json</button>
                </div>
                <div style="position:relative; display:inline-block; max-width:65%;">
                    <img id="imgA" class="orb-canvas" alt="Image A preview" hidden/>
                    <div id="cropBoxOrb" class="crop-box orb-canvas" style="position:absolute;" hidden>
                    <div class="resize-handle" data-corner="nw"></div>
                    <div class="resize-handle" data-corner="ne"></div>
                    <div class="resize-handle" data-corner="sw"></div>
                    <div class="resize-handle" data-corner="se"></div>
                    </div>
                    <canvas id="canvasA" class="orb-canvas" style="max-width:100%;" hidden></canvas>
                    <div id="statsA" class="mono muted"></div>
                </div>
            </div>

            <div class="upload-wrapper">
                <h2>Match Saved ORB Features to Image B</h2>
                <div class="controls card">
                    <input id="fileJSON" type="file" accept=".json,application/json" />
                    <input id="fileB" type="file" accept="image/*" />
                </div>
            </div>  
            
            <div id="matchSection">
                <div class="row" style="width:100%; align-items:flex-start; gap:24px; justify-content: space-between;">
                    <div class="column muted params">
                        <div class="row param">
                        ratio <input id="ratio" type="number" step="0.01" value="0.75">
                        </div>
                        <div class="row param">
                        RANSACthresh <input id="ransac" type="number" step="0.1" value="3.0">       
                        </div>
                        <button id="btnMatch" style="margin-top: 24px; width: 100%;" disabled>Match</button>
                    </div>
                    
                    <div id="imgWrapperB" style="position:relative; display:inline-block; max-width: 65%;">
                        <img id="imgB" class="orb-canvas" alt="Image B preview" hidden/>
                        <div id="cropBoxB" class="crop-box orb-canvas" style="position:absolute;" hidden>
                        <div class="resize-handle" data-corner="nw"></div>
                        <div class="resize-handle" data-corner="ne"></div>
                        <div class="resize-handle" data-corner="sw"></div>
                        <div class="resize-handle" data-corner="se"></div>
                        </div>  
                    </div>   
                </div>
                <canvas id="canvasMatches" class="orb-canvas" style="width:100%;" hidden></canvas>
                <div id="statsB" class="mono muted"></div> 
                <!-- Transformed Landmarks Frame Navigation -->
                <div id="landmarkNav" style="display:none; margin:24px 0px; gap: 10px; justify-self: center;">
                    <button id="prevLandmarkBtn">Previous</button>
                    <span id="landmarkFrameCounter"></span>
                    <button id="nextLandmarkBtn">Next</button>
                </div>
                <div style="text-align:center;">
                    <img id="landmarkFrameImg" style="max-width:90%; margin: 16px 0;" />
                </div> 
            </div>  
        </div>

        <!-- Main JavaScript Modules -->
        <script type="module" src="pose/main.js"></script>
        <script type="module" src="orb/main.js"></script>
    </body>
</html>